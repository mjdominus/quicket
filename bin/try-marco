#!/usr/bin/env python3

from marko.parser import Parser
from pprint import pprint

s = """
# This is a header 1

* Bullet item 1
* Bullet item 2
* Bullet item 3

# This is a second head 1

And some raw text

1. Numbered list
2. Numbered list

--------

I like pie
Especially raspberry

        code block
        code block
        code block

### Head3

- [ ] checkbox 1
- [x] checkbox checked
- [ ] checkbox un checked

"""


p = Parser()
res = p.parse(s)
print(dir(res))
print(res.__dict__)

import re

def listattrs(lb):
    return { k: lb.__dict__[k] for k in ("ordered", "start", "tight", "bullet") }

def attrs(b):
    at = [ x for x in b.__dict__.keys() if x != 'children'
           and not x.startswith('_') ]
    return { k: b.__dict__[k] for k in at }

def dump_block(b):
    if isinstance(b, str):
        return [ "str", b ]

    t = b.get_type()
    if t == "BlankLine" or t == "ThematicBreak" or t == "LineBreak":
        return t
    elif t == "RawText":
        return [ "RawText", b.children ]
    else:
        z = attrs(b)
        if len(z) == 0:
            return [ t ] + [ dump_block(sb) for sb in b.children ]
        else:
            return [ t, attrs(b) ] + [ dump_block(sb) for sb in b.children ]

pprint(dump_block(res))


# ['Document',
#  {'link_ref_defs': {}},
#  'BlankLine',
#  ['Heading', {'level': 1}, ['RawText', 'This is a header 1']],
#  'BlankLine',
#  ['List',
#   {'bullet': '*', 'ordered': False, 'start': 1, 'tight': True},
#   ['ListItem', ['Paragraph', ['RawText', 'Bullet item 1']]],
#   ['ListItem', ['Paragraph', ['RawText', 'Bullet item 2']]],
#   ['ListItem', ['Paragraph', ['RawText', 'Bullet item 3']]]],
#  'BlankLine',
#  ['Heading', {'level': 1}, ['RawText', 'This is a second head 1']],
#  'BlankLine',
#  ['Paragraph', ['RawText', 'And some raw text']],
#  'BlankLine',
#  ['List',
#   {'bullet': '1.', 'ordered': True, 'start': 1, 'tight': True},
#   ['ListItem', ['Paragraph', ['RawText', 'Numbered list']]],
#   ['ListItem', ['Paragraph', ['RawText', 'Numbered list']]]],
#  'BlankLine',
#  'ThematicBreak',
#  'BlankLine',
#  ['Paragraph',
#   ['RawText', 'I like pie'],
#   'LineBreak',
#   ['RawText', 'Especially raspberry']],
#  'BlankLine',
#  ['CodeBlock',
#   {'extra': '', 'lang': ''},
#   ['RawText', '    code block\n    code block\n    code block\n']],
#  'BlankLine',
#  ['Heading', {'level': 3}, ['RawText', 'Head3']],
#  'BlankLine']
